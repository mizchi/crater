// Generated by `wit-bindgen` 0.47.0, modified to call crater implementation

///|
/// Compute layout from HTML (returns JSON string with flat layout)
/// JSON format: { "nodes": [...], "rootId": "..." }
pub fn compute_layout(html : String, width : UInt, height : UInt) -> String {
  let result = @crater.computeLayout(
    html,
    width.reinterpret_as_int(),
    height.reinterpret_as_int(),
  )
  flat_layout_to_json(result)
}

///|
fn flat_layout_to_json(result : @crater.FlatLayoutResult) -> String {
  let buf = StringBuilder::new()
  buf.write_string("{\"rootId\":\"")
  buf.write_string(escape_json(result.root_id))
  buf.write_string("\",\"nodes\":[")
  for i, node in result.nodes {
    if i > 0 {
      buf.write_string(",")
    }
    buf.write_string("{\"id\":\"")
    buf.write_string(escape_json(node.id))
    buf.write_string("\",\"parentId\":\"")
    buf.write_string(escape_json(node.parent_id))
    buf.write_string("\",\"index\":")
    buf.write_string(node.index.to_string())
    buf.write_string(",\"x\":")
    buf.write_string(node.x.to_string())
    buf.write_string(",\"y\":")
    buf.write_string(node.y.to_string())
    buf.write_string(",\"width\":")
    buf.write_string(node.width.to_string())
    buf.write_string(",\"height\":")
    buf.write_string(node.height.to_string())
    buf.write_string(",\"contentX\":")
    buf.write_string(node.content_x.to_string())
    buf.write_string(",\"contentY\":")
    buf.write_string(node.content_y.to_string())
    buf.write_string(",\"contentWidth\":")
    buf.write_string(node.content_width.to_string())
    buf.write_string(",\"contentHeight\":")
    buf.write_string(node.content_height.to_string())
    if node.text.length() > 0 {
      buf.write_string(",\"text\":\"")
      buf.write_string(escape_json(node.text))
      buf.write_string("\"")
    }
    buf.write_string("}")
  }
  buf.write_string("]}")
  buf.to_string()
}

///|
fn escape_json(s : String) -> String {
  let buf = StringBuilder::new()
  for c in s {
    match c {
      '"' => buf.write_string("\\\"")
      '\\' => buf.write_string("\\\\")
      '\n' => buf.write_string("\\n")
      '\r' => buf.write_string("\\r")
      '\t' => buf.write_string("\\t")
      _ => buf.write_char(c)
    }
  }
  buf.to_string()
}
